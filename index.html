<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/logo192.png" />
  <!-- viewport-fit=cover: extiende la app detrás de la notch y barra de estado -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <!-- theme-color naranja oscuro — pinta la barra de estado del sistema -->
  <meta name="theme-color" content="#111827" />
  <!-- iOS: barra de estado translúcida para que el fondo de la app aparezca detrás -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="description" content="Sistema de Punto de Venta (POS)" />
  <title>MiNegocio POS</title>
  <link rel="manifest" href="/manifest.json" />
</head>

<body>
  <div id="root"></div>

  <script>
    window.addEventListener('error', function (e) {
      if (e.message && (
        e.message.includes('Loading chunk') ||
        e.message.includes('import') ||
        e.message.includes('not found') ||
        e.message.includes('Unexpected token') ||
        e.message.includes('Failed to fetch')
      )) {
        console.error('⚠️ Error crítico de versión detectado. Iniciando limpieza de emergencia...');
        nukeCacheAndReload();
      }
    }, true);

    async function nukeCacheAndReload() {
      try {
        if ('serviceWorker' in navigator) {
          const registrations = await navigator.serviceWorker.getRegistrations();
          for (let registration of registrations) {
            await registration.unregister();
          }
        }
        if ('caches' in window) {
          const keys = await caches.keys();
          for (let key of keys) {
            await caches.delete(key);
          }
        }
      } catch (err) {
        console.error("Error al limpiar caché:", err);
      } finally {
        window.location.reload(true);
      }
    }

    setTimeout(() => {
      const root = document.getElementById('root');
      if (root && root.innerHTML.trim() === '') {
        console.warn('⚠️ La app tardó demasiado en arrancar. Posible error de caché.');
        if (!window.location.hostname.includes('localhost')) {
          nukeCacheAndReload();
        }
      }
    }, 4000);
  </script>
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>
